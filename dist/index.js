!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["wx-query"]={})}(this,(function(e){"use strict";const t=e=>{Array.isArray(e)&&e.map((e=>{o(e)})),"function"==typeof e&&o(e)};function o(e){e.prototype.create=function(){return new e},e.create=function(){return new e},e.pages=[],e.getPages=function(){return this.pages}}const s=e=>"object"!=typeof e||!Object.keys(e).length,n=function(e){console.warn(e)},r=function(e){console.error(e)},a=function(e,t,o){e.push=function(...s){Array.prototype.push.call(e,...s),t.setData({[o]:e})},e.pop=function(...s){Array.prototype.pop.call(e,...s),t.setData({[o]:e})},e.shift=function(...s){Array.prototype.shift.call(e,...s),t.setData({[o]:e})},e.unshift=function(...s){Array.prototype.unshift.call(e,...s),t.setData({[o]:e})}};function i(e){e.prototype.init=u,e.init=u}function u(e){if(e.createDataKey)throw new Error("请不要取名createDataKey");s(this.plugins)||(e.$keyName?e[e.$keyName]=this.plugins:e.$=this.plugins),e.createDataKey=c,e.onReady&&e.onReady(),e.onReady=function(){this.observeData&&this.createDataKey(e.observeData,"observeData",this,"observeData")},Page(e)}function c(e,t,o,s){console.log(o.createDataKey);for(const n in e)if("Object"==e[n].constructor.name)o.createDataKey(e[n],t+"$$"+n,o,s+"."+n);else{"Array"==e[n].constructor.name&&a(e[n],o,t+"$$"+n),o.setData({[t+"$$"+n]:e[n]}),Object.defineProperty(o.data,t+"$$"+n,{set(e){let s=(t+"$$"+n).split("$$");if(2==s.length)return void(o.observeData[s[1]]!==e&&(o.observeData[s[1]]=e));let r={};for(let t=1;t<s.length;t++)t<s.length-1?r=o.observeData[s[t]]:r[n]!==e&&(r[n]=e)},get:()=>e[n]});let r=s.split("."),i=o;r.map((e=>{i=i[e]})),e["_"+n]=e[n],Object.defineProperty(i,n,{set(s){e["_"+n]=s,o.setData({[t+"$$"+n]:s})},get:()=>e["_"+n]})}}const h=e=>{Array.isArray(e)&&e.map((e=>{p(e)})),"function"==typeof e&&p(e)};function p(e){e.prototype.plugins={},e.plugins={}}const l=e=>{Array.isArray(e)&&e.map((e=>{f(e)})),"function"==typeof e&&f(e)};function f(e){e.prototype.use=function(t){console.warn(t);try{Array.isArray(t)?t.map((t=>{t.install&&t.install(e)})):t.install&&t.install(e)}catch(e){r("plugin need a install function")}return e},e.use=function(t){try{Array.isArray(t)?t.map((t=>{t.install&&t.install(e)})):t.install&&t.install(e)}catch(e){r("plugin need a install function")}return e}}function y(){}var d;y.pages=[],l(y),t(y),d=y,Array.isArray(d)&&d.map((e=>{i(e)})),"function"==typeof d&&i(d),h(y);const g=function(e,t,o){e.push=function(...s){Array.prototype.push.call(e,...s),t.setData({[o]:e})},e.pop=function(...s){Array.prototype.pop.call(e,...s),t.setData({[o]:e})},e.shift=function(...s){Array.prototype.shift.call(e,...s),t.setData({[o]:e})},e.unshift=function(...s){Array.prototype.unshift.call(e,...s),t.setData({[o]:e})}};function x(e){e.prototype.init=b,e.init=b}function b(e){if(e.createDataKey)throw new Error("请不要取名createDataKey");s(this.plugins)||(e.$keyName?e[e.$keyName]=this.plugins:e.$=this.plugins),e?.lifetimes?.ready&&e.lifetimes.ready(),e?.ready&&e.ready(),e?.ready?e.ready=function(){this.createDataKey=m,e.observeData&&(this.observeData=e.observeData,this.createDataKey(e.observeData,"observeData",this,"observeData"))}:(e.lifetimes=e.lifetimes||{},e.lifetimes.ready=function(){this.createDataKey=m,e.observeData&&(this.observeData=e.observeData,this.createDataKey(e.observeData,"observeData",this,"observeData"))}),Component(e)}function m(e,t,o,s){for(const n in e)if(console.log(n,e),"Object"==e[n].constructor.name)o.createDataKey(e[n],t+"$$"+n,o,s+"."+n);else{"Array"==e[n].constructor.name&&g(e[n],o,t+"$$"+n),o.setData({[t+"$$"+n]:e[n]}),Object.defineProperty(o.data,t+"$$"+n,{set(e){let s=(t+"$$"+n).split("$$");if(2==s.length)return void(o.observeData[s[1]]!==e&&(o.observeData[s[1]]=e));let r={};for(let t=1;t<s.length;t++)t<s.length-1?r=o.observeData[s[t]]:r[n]!==e&&(r[n]=e)},get:()=>e[n]});let r=s.split("."),a=o;r.map((e=>{a=a[e]})),e["_"+n]=e[n],Object.defineProperty(a,n,{set(s){e["_"+n]=s,o.setData({[t+"$$"+n]:s})},get:()=>e["_"+n]})}}function k(){}function D(){this.handlers=[]}function $(e){this.baseURL=e?.baseURL||"",this.timeout=e?.timeout||1e4,this.headers=e?.headers||{},this.interceptors={request:new D,response:new D}}function w(e){let t=e||{},o=this.interceptors.request.handlers.length,s=0;for(;s<o;){try{t=this.interceptors.request.handlers[s].success(e)}catch(e){this.interceptors.request.handlers[s].fail(e);break}s++}let n=this;return new Promise(((e,o)=>{wx.request({...t,url:this.baseURL?this.baseURL+t.url:t.url,timeout:t.timeout?t.timeout:this.timeout,headers:t.headers?t.headers:this.headers,success(t){let o=t,s=n.interceptors.response.handlers.length,r=0;for(;r<s;)o=/2\d+/.test(t.statusCode)?n.interceptors.response.handlers[r].success(t):n.interceptors.response.handlers[r].fail(t),r++;e(o)},fail(e){o(e)}})}))}k.pages=[],l(k),t(k),(e=>{Array.isArray(e)&&e.map((e=>{x(e)})),"function"==typeof e&&x(e)})(k),h(k),D.prototype.use=function(e,t){return this.handlers.push({success:e,fail:t}),this.handlers.length-1},D.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},D.prototype.clear=function(){this.handlers&&(this.handlers=[])},$.prototype.request=w,$.prototype.install=function(e){e.plugins.$request=this},$.prototype.post=function(e,t={}){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"post"})},$.prototype.get=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"get"})},$.prototype.delete=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"delete"})},$.prototype.head=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"head"})},$.prototype.trace=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"trace"})},$.prototype.put=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"put"})},$.prototype.options=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"options"})},$.prototype.connect=function(e,t){return"object"!=typeof t&&(t={}),this.request({url:e,...t,method:"connect"})};function v(e){e.create=function(e){return new $(e)}}function R(e){let t={...R.defaultConfig,interceptors:R.interceptors};return w.call(t,e)}R.interceptors={request:new D,response:new D},R.defaultConfig={},R.install=function(e){e.plugins.$request=R},(e=>{Array.isArray(e)&&e.map((e=>{v(e)})),"function"==typeof e&&v(e)})(R);class Q{quees=[];isExcute(){return this.quees.find((e=>!e.nextPage))}reset(){this.quees.map((e=>{e.reset()}))}execute(){this.quees.map((e=>{e.execute()}))}}function A(){this.isWatchRouter=!1}A.stack={currentPage:null,lastPage:null,routes:[]},function(e){e.hooksQuee=new Q}(A),(e=>{e.prototype.beforeEach=function(t){"function"!=typeof t&&r("beforeEach arg not a function"),this.isWatchRouter=!0,e.hooksQuee.quees.push(function(e,t){return{nextPage:!1,reset:function(){this.nextPage=!1},fn:e,execute:function(){this.fn(t.stack.lastPage,t.stack.currentPage,this.next.bind(this))},next:function(){this.nextPage=!0}}}(t,e))}})(A),(e=>{e.prototype.testpush=function(t){e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||(this.isWatchRouter&&e.hooksQuee.reset(),console.log("执行成功",e.hooksQuee))},e.prototype.switchTab=function(t){let o=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.switchTab({...t,complete:function(s){o.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,s)}})},e.prototype.reLaunch=function(t){let o=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.reLaunch({...t,complete:function(s){o.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,s)}})},e.prototype.redirectTo=function(t){let o=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.redirectTo({...t,complete:function(s){o.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,s)}})},e.prototype.navigateTo=function(t){let o=this;console.log(this),this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateTo({...t,success:function(e){console.log(e),t?.success?.call(wx,e)},complete:function(s){o.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,s)}})},e.prototype.navigateBack=function(t){let o=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateBack({...t,complete:function(s){o.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,s)}})}})(A),A.prototype.updateStack=function(e){A.stack.lastPage=getCurrentPages()&&getCurrentPages().length&&getCurrentPages()[0].route,A.stack.currentPage=e.url};e.WxComponet=k,e.WxRequest=R,e.WxRouter=()=>new A,e.wxPage=y,Object.defineProperty(e,"__esModule",{value:!0})}));
