const t=t=>{Array.isArray(t)&&t.map((t=>{e(t)})),"function"==typeof t&&e(t)};function e(t){t.prototype.create=function(){return new t},t.create=function(){return new t},t.pages=[],t.getPages=function(){return this.pages}}const o=t=>"object"!=typeof t||!Object.keys(t).length,s=function(t){console.warn(t)},n=function(t){console.error(t)};function r(){}function i(t,e){if(t.Store&&t.Store.length){if("Array"!==t.Store.constructor.name)return void error("Store must a array");e.updateStoreState=function(t,o){e.setData({[t]:o})};for(let o=0;o<t.Store.length;o++)t.Store[o].init(e),r.pushDep(t.Store[o].id,e)}}r.data={},r.addDep=function(t){r.data[t]=[]},r.pushDep=function(t,e){if(!r.data[t])return void n("Store "+t+" is not create");const o=r.data[t].findIndex((t=>t.is==e.is));return o>-1?r.data[t].splice(o,1,e):r.data[t].push(e),t+(r.data[t].length-1)},r.watch=function(t,e,o){r.data[o].map((o=>{o.updateStoreState(t,e)}))},r.has=function(t,e){return!!r.data[t].find((t=>t.is==e.is))};const a=function(t,e,o){t.push=function(...s){Array.prototype.push.call(t,...s),e.setData({[o]:t})},t.pop=function(...s){Array.prototype.pop.call(t,...s),e.setData({[o]:t})},t.shift=function(...s){Array.prototype.shift.call(t,...s),e.setData({[o]:t})},t.unshift=function(...s){Array.prototype.unshift.call(t,...s),e.setData({[o]:t})},t.concat=function(...s){Array.prototype.concat.call(t,...s),e.setData({[o]:t})}};function c(t,e,o,s){for(const n in t)if("Object"==t[n].constructor.name)o.createDataKey(t[n],e+"$$"+n,o,s+"."+n);else{"Array"==t[n].constructor.name&&a(t[n],o,e+"$$"+n),o.setData({[e+"$$"+n]:t[n]}),Object.defineProperty(o.data,e+"$$"+n,{set(t){let s=(e+"$$"+n).split("$$");if(2==s.length)return void(o.observeData[s[1]]!==t&&(o.observeData[s[1]]=t));let r={};for(let e=1;e<s.length;e++)e<s.length-1?r=o.observeData[s[e]]:r[n]!==t&&(r[n]=t)},get:()=>t[n]});let r=s.split("."),i=o;r.map((t=>{i=i[t]})),t["_"+n]=t[n],Object.defineProperty(i,n,{set(s){t["_"+n]=s,o.setData({[e+"$$"+n]:s})},get:()=>t["_"+n]})}}function u(t){t.prototype.init=h,t.init=h}function h(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");o(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins),t.createDataKey=c;let e=t.onReady?t.onReady:null;t.onReady=function(){i(t,this),e&&e.call(this),this.observeData&&this.createDataKey(t.observeData,"observeData",this,"observeData")},Page(t)}const l=t=>{Array.isArray(t)&&t.map((t=>{p(t)})),"function"==typeof t&&p(t)};function p(t){t.prototype.plugins={},t.plugins={}}const f=t=>{Array.isArray(t)&&t.map((t=>{d(t)})),"function"==typeof t&&d(t)};function d(t){t.prototype.use=function(e){console.warn(e);try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){n("plugin need a install function")}return t},t.use=function(e){try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){n("plugin need a install function")}return t}}function y(){}var g;y.pages=[],f(y),t(y),g=y,Array.isArray(g)&&g.map((t=>{u(t)})),"function"==typeof g&&u(g),l(y);function x(t){t.prototype.init=m,t.init=m}function m(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");o(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins);let e=t?.lifetimes?.ready?t.lifetimes.ready:null;e=e||(t?.ready?t?.ready:null),t?.ready?t.ready=function(){i(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}:(t.lifetimes=t.lifetimes||{},t.lifetimes.ready=function(){i(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}),Component(t)}function b(){}function k(){this.handlers=[]}function $(t){this.baseURL=t?.baseURL||"",this.timeout=t?.timeout||1e4,this.headers=t?.headers||{},this.interceptors={request:new k,response:new k}}function D(t){let e=t||{},o=this.interceptors.request.handlers.length,s=0;for(;s<o;){try{e=this.interceptors.request.handlers[s].success(t)}catch(t){this.interceptors.request.handlers[s].fail(t);break}s++}let n=this;return new Promise(((t,o)=>{wx.request({...e,url:this.baseURL?this.baseURL+e.url:e.url,timeout:e.timeout?e.timeout:this.timeout,headers:e.headers?e.headers:this.headers,success(e){let o=e,s=n.interceptors.response.handlers.length,r=0;for(;r<s;)o=/2\d+/.test(e.statusCode)?n.interceptors.response.handlers[r].success(e):n.interceptors.response.handlers[r].fail(e),r++;t(o)},fail(t){o(t)}})}))}b.pages=[],f(b),t(b),(t=>{Array.isArray(t)&&t.map((t=>{x(t)})),"function"==typeof t&&x(t)})(b),l(b),k.prototype.use=function(t,e){return this.handlers.push({success:t,fail:e}),this.handlers.length-1},k.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},k.prototype.clear=function(){this.handlers&&(this.handlers=[])},$.prototype.request=D,$.prototype.install=function(t){t.plugins.$request=this},$.prototype.post=function(t,e={}){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"post"})},$.prototype.get=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"get"})},$.prototype.delete=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"delete"})},$.prototype.head=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"head"})},$.prototype.trace=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"trace"})},$.prototype.put=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"put"})},$.prototype.options=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"options"})},$.prototype.connect=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"connect"})};function w(t){t.create=function(t){return new $(t)}}function v(t){let e={...v.defaultConfig,interceptors:v.interceptors};return D.call(e,t)}v.interceptors={request:new k,response:new k},v.defaultConfig={},v.install=function(t){t.plugins.$request=v},(t=>{Array.isArray(t)&&t.map((t=>{w(t)})),"function"==typeof t&&w(t)})(v);class R{quees=[];isExcute(){return this.quees.find((t=>!t.nextPage))}reset(){this.quees.map((t=>{t.reset()}))}execute(){this.quees.map((t=>{t.execute()}))}}function Q(){this.isWatchRouter=!1}Q.stack={currentPage:null,lastPage:null,routes:[]},function(t){t.hooksQuee=new R}(Q),(t=>{t.prototype.beforeEach=function(e){"function"!=typeof e&&n("beforeEach arg not a function"),this.isWatchRouter=!0,t.hooksQuee.quees.push(function(t,e){return{nextPage:!1,reset:function(){this.nextPage=!1},fn:t,execute:function(){this.fn(e.stack.lastPage,e.stack.currentPage,this.next.bind(this))},next:function(){this.nextPage=!0}}}(e,t))}})(Q),(t=>{t.prototype.testpush=function(e){t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||this.isWatchRouter&&t.hooksQuee.reset()},t.prototype.switchTab=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.switchTab({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.reLaunch=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.reLaunch({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.redirectTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.redirectTo({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.navigateTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateTo({...e,success:function(t){e?.success?.call(wx,t)},complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.navigateBack=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?s("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateBack({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})}})(Q),Q.prototype.updateStack=function(t){Q.stack.lastPage=getCurrentPages()&&getCurrentPages().length&&getCurrentPages()[0].route,Q.stack.currentPage=t.url};const A=()=>new Q,E=function(t,e){const o=e._state;let s={};for(const n in t)s[n]=t[n].bind(o),e[n]=s[n];e.actions=s},q=function(t,e){const o=e._state,s={};for(const n in t)s[n]=t[n].call(e,o);e.getters=s,e.gettersMethod=t},W=function(t,e){t||n("state is need in Stroe options"),"function"!=typeof t&&n("state not is a function"),e._da=t(),e._state=t(),e.stateMoudle=t};function P(t,e){this.id=t;const{getters:o,actions:s,state:n}=e;W(n,this),q(o,this),E(s,this),S(this._state,"$store$$"+this.id,this)}function S(t,e,o,s){for(const s in t)t[s]&&"Object"==t[s].constructor.name?S(t[s],e+"$$"+s,o):Object.defineProperty(t,s,{set(t){j(o,e,s,t)},get:()=>o[e+"$$"+s]})}function j(t,e,o,s){t[e+"$$"+o]=s,q(t.gettersMethod,t),r.watch(e+"$$"+o,s,t.id);let n=(e+"$$"+o).split("$$");if(3==n.length)return void(t._da[n[2]]!==s&&(t._da[n[2]]=s));let i={};for(let e=2;e<n.length;e++)e<n.length-1?i=t._da[n[e]]:i[o]!==s&&(i[o]=s)}function _(t,e,o,s){for(const s in t)t[s]&&"Object"==t[s].constructor.name?_(t[s],e+"$$"+s,o):o.setData({[e+"$$"+s]:t[s]})}function K(t,e){return r.addDep(t),new P(t,e)}P.prototype.init=function(t){return _(this._da,"$store$$"+this.id,t),r.has(this.id,t,this)};export{v as WxRequest,A as WxRouter,K as createStore,b as wxComponet,y as wxPage};
