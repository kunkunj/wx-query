function e(e){e.prototype.create=function(){return new e},e.create=function(){return new e},e.pages=[],e.getPages=function(){return this.pages}}const t=e=>"object"!=typeof e||!Object.keys(e).length,o=function(e){console.warn(e)};function s(e){e.prototype.init=n,e.init=n}function n(e){if(e.createDataKey)throw new Error("请不要取名createDataKey");e.createDataKey=function(e,t,o,s){for(const n in e)if("object"==typeof e[n])o.createDataKey(e[n],t+"$$"+n,o,s+"."+n);else if(["string","number"].includes(typeof e[n])){o.setData({[t+"$$"+n]:e[n]}),Object.defineProperty(o.data,t+"$$"+n,{set(e){let s=(t+"$$"+n).split("$$");if(2==s.length)return void(o.observeData[s[1]]!==e&&(o.observeData[s[1]]=e));let u={};for(let t=1;t<s.length;t++)t<s.length-1?u=o.observeData[s[t]]:u[n]!==e&&(u[n]=e)},get:()=>e[n]});let u=s.split("."),c=o;u.map((e=>{c=c[e]})),e["_"+n]=e[n],Object.defineProperty(c,n,{set(s){e["_"+n]=s,o.setData({[t+"$$"+n]:s})},get:()=>e["_"+n]})}},t(this.plugins)||(e.$keyName?e[e.$keyName]=this.plugins:e.$=this.plugins),e.onReady&&e.onReady(),e.onReady=function(){this.observeData&&this.createDataKey(e.observeData,"observeData",this,"observeData")},a.pages.push(e),Page(e)}function u(e){e.prototype.plugins={},e.plugins={}}function c(e){e.prototype.use=function(t){return Array.isArray(t)?t.map((t=>{t.install?.call(null,e)})):t.install?.call(null,e),e},e.use=function(t){return Array.isArray(t)?t.map((t=>{t.install?.call(null,e)})):t.install?.call(null,e),e}}function a(){}var i;function r(){}a.pages=[],i=a,Array.isArray(i)&&i.map((e=>{c(e)})),"function"==typeof i&&c(i),(t=>{Array.isArray(t)&&t.map((t=>{e(t)})),"function"==typeof t&&e(t)})(a),(e=>{Array.isArray(e)&&e.map((e=>{s(e)})),"function"==typeof e&&s(e)})(a),(e=>{Array.isArray(e)&&e.map((e=>{u(e)})),"function"==typeof e&&u(e)})(a),r.prototype.instance=function(){};const h={install(e){e.plugins.$request=r}};class l{quees=[];isExcute(){return this.quees.find((e=>!e.nextPage))}reset(){this.quees.map((e=>{e.reset()}))}execute(){this.quees.map((e=>{e.execute()}))}}function p(){this.isWatchRouter=!1}p.stack={currentPage:null,lastPage:null,routes:[]},function(e){e.hooksQuee=new l}(p),(e=>{e.prototype.beforeEach=function(t){var o;"function"!=typeof t&&(o="beforeEach arg not a function",console.error(o)),this.isWatchRouter=!0,e.hooksQuee.quees.push(function(e,t){return{nextPage:!1,reset:function(){this.nextPage=!1},fn:e,execute:function(){this.fn(t.stack.lastPage,t.stack.currentPage,this.next.bind(this))},next:function(){this.nextPage=!0}}}(t,e))}})(p),(e=>{e.prototype.testpush=function(t){e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||(this.isWatchRouter&&e.hooksQuee.reset(),console.log("执行成功",e.hooksQuee))},e.prototype.switchTab=function(t){let s=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.switchTab({...t,complete:function(o){s.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,o)}})},e.prototype.reLaunch=function(t){let s=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.reLaunch({...t,complete:function(o){s.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,o)}})},e.prototype.redirectTo=function(t){let s=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.redirectTo({...t,complete:function(o){s.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,o)}})},e.prototype.navigateTo=function(t){let s=this;console.log(this),this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateTo({...t,success:function(e){console.log(e),t?.success?.call(wx,e)},complete:function(o){s.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,o)}})},e.prototype.navigateBack=function(t){let s=this;this.updateStack(t),e.hooksQuee.execute(),e.hooksQuee.isExcute()&&this.isWatchRouter?o("beforeEach hook need to execute next"):e.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateBack({...t,complete:function(o){s.isWatchRouter&&e.hooksQuee.reset(),t?.complete?.call(wx,o)}})}})(p),p.prototype.updateStack=function(e){p.stack.lastPage=getCurrentPages()&&getCurrentPages().length&&getCurrentPages()[0].route,p.stack.currentPage=e.url};const f=()=>new p;export{h as WxRequest,f as WxRouter,a as wxPage};
