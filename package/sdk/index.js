const t=t=>{Array.isArray(t)&&t.map((t=>{e(t)})),"function"==typeof t&&e(t)};function e(t){t.prototype.create=function(){return new t},t.create=function(){return new t},t.pages=[],t.getPages=function(){return this.pages}}const o=t=>"object"!=typeof t||!Object.keys(t).length,n=function(t){console.warn(t)},s=function(t){console.error(t)};function r(){}function a(t,e){if(t.Store&&t.Store.length){if("Array"!==t.Store.constructor.name)return void error("Store must a array");e.updateStoreState=function(t,o){e.setData({[t]:o})};for(let o=0;o<t.Store.length;o++)t.Store[o].init(e),r.pushDep(t.Store[o].id,e)}}r.data={},r.addDep=function(t){r.data[t]=[]},r.pushDep=function(t,e){if(!r.data[t])return void s("Store"+t+" is not create");const o=r.data[t].findIndex((t=>t.is==e.is));return o>-1?r.data[t].splice(o,1,e):r.data[t].push(e),t+(r.data[t].length-1)},r.watch=function(t,e,o){r.data[o].map((o=>{o.updateStoreState(t,e)}))},r.has=function(t,e){return!!r.data[t].find((t=>t.is==e.is))};const i=function(t,e,o){t.push=function(...n){Array.prototype.push.call(t,...n),e.setData({[o]:t})},t.pop=function(...n){Array.prototype.pop.call(t,...n),e.setData({[o]:t})},t.shift=function(...n){Array.prototype.shift.call(t,...n),e.setData({[o]:t})},t.unshift=function(...n){Array.prototype.unshift.call(t,...n),e.setData({[o]:t})},t.concat=function(...n){Array.prototype.concat.call(t,...n),e.setData({[o]:t})}};function c(t,e,o,n){for(const s in t)if("Object"==t[s].constructor.name)o.createDataKey(t[s],e+"$$"+s,o,n+"."+s);else{"Array"==t[s].constructor.name&&i(t[s],o,e+"$$"+s),o.setData({[e+"$$"+s]:t[s]}),Object.defineProperty(o.data,e+"$$"+s,{set(t){let n=(e+"$$"+s).split("$$");if(2==n.length)return void(o.observeData[n[1]]!==t&&(o.observeData[n[1]]=t));let r={};for(let e=1;e<n.length;e++)e<n.length-1?r=o.observeData[n[e]]:r[s]!==t&&(r[s]=t)},get:()=>t[s]});let r=n.split("."),a=o;r.map((t=>{a=a[t]})),t["_"+s]=t[s],Object.defineProperty(a,s,{set(n){t["_"+s]=n,o.setData({[e+"$$"+s]:n})},get:()=>t["_"+s]})}}function u(t){t.prototype.init=h,t.init=h}function h(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");o(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins),t.createDataKey=c;let e=t.onReady?t.onReady:null;t.onReady=function(){a(t,this),e&&e.call(this),this.observeData&&this.createDataKey(t.observeData,"observeData",this,"observeData")},Page(t)}const p=t=>{Array.isArray(t)&&t.map((t=>{l(t)})),"function"==typeof t&&l(t)};function l(t){t.prototype.plugins={},t.plugins={}}const f=t=>{Array.isArray(t)&&t.map((t=>{y(t)})),"function"==typeof t&&y(t)};function y(t){t.prototype.use=function(e){console.warn(e);try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){s("plugin need a install function")}return t},t.use=function(e){try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){s("plugin need a install function")}return t}}function d(){}var g;d.pages=[],f(d),t(d),g=d,Array.isArray(g)&&g.map((t=>{u(t)})),"function"==typeof g&&u(g),p(d);function m(t){t.prototype.init=x,t.init=x}function x(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");o(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins);let e=t?.lifetimes?.ready?t.lifetimes.ready:null;e=e||(t?.ready?t?.ready:null),t?.ready?t.ready=function(){a(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}:(t.lifetimes=t.lifetimes||{},t.lifetimes.ready=function(){a(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}),Component(t)}function b(){}function k(){this.handlers=[]}function $(t){this.baseURL=t?.baseURL||"",this.timeout=t?.timeout||1e4,this.headers=t?.headers||{},this.interceptors={request:new k,response:new k}}function D(t){let e=t||{},o=this.interceptors.request.handlers.length,n=0;for(;n<o;){try{e=this.interceptors.request.handlers[n].success(t)}catch(t){this.interceptors.request.handlers[n].fail(t);break}n++}let s=this;return new Promise(((t,o)=>{wx.request({...e,url:this.baseURL?this.baseURL+e.url:e.url,timeout:e.timeout?e.timeout:this.timeout,headers:e.headers?e.headers:this.headers,success(e){let o=e,n=s.interceptors.response.handlers.length,r=0;for(;r<n;)o=/2\d+/.test(e.statusCode)?s.interceptors.response.handlers[r].success(e):s.interceptors.response.handlers[r].fail(e),r++;t(o)},fail(t){o(t)}})}))}b.pages=[],f(b),t(b),(t=>{Array.isArray(t)&&t.map((t=>{m(t)})),"function"==typeof t&&m(t)})(b),p(b),k.prototype.use=function(t,e){return this.handlers.push({success:t,fail:e}),this.handlers.length-1},k.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},k.prototype.clear=function(){this.handlers&&(this.handlers=[])},$.prototype.request=D,$.prototype.install=function(t){t.plugins.$request=this},$.prototype.post=function(t,e={}){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"post"})},$.prototype.get=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"get"})},$.prototype.delete=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"delete"})},$.prototype.head=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"head"})},$.prototype.trace=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"trace"})},$.prototype.put=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"put"})},$.prototype.options=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"options"})},$.prototype.connect=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"connect"})};function w(t){t.create=function(t){return new $(t)}}function v(t){let e={...v.defaultConfig,interceptors:v.interceptors};return D.call(e,t)}v.interceptors={request:new k,response:new k},v.defaultConfig={},v.install=function(t){t.plugins.$request=v},(t=>{Array.isArray(t)&&t.map((t=>{w(t)})),"function"==typeof t&&w(t)})(v);class A{quees=[];isExcute(){return this.quees.find((t=>!t.nextPage))}reset(){this.quees.map((t=>{t.reset()}))}execute(){this.quees.map((t=>{t.execute()}))}}function R(){this.isWatchRouter=!1}R.stack={currentPage:null,lastPage:null,routes:[]},function(t){t.hooksQuee=new A}(R),(t=>{t.prototype.beforeEach=function(e){"function"!=typeof e&&s("beforeEach arg not a function"),this.isWatchRouter=!0,t.hooksQuee.quees.push(function(t,e){return{nextPage:!1,reset:function(){this.nextPage=!1},fn:t,execute:function(){this.fn(e.stack.lastPage,e.stack.currentPage,this.next.bind(this))},next:function(){this.nextPage=!0}}}(e,t))}})(R),(t=>{t.prototype.testpush=function(e){t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||this.isWatchRouter&&t.hooksQuee.reset()},t.prototype.switchTab=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.switchTab({...e,complete:function(n){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,n)}})},t.prototype.reLaunch=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.reLaunch({...e,complete:function(n){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,n)}})},t.prototype.redirectTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.redirectTo({...e,complete:function(n){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,n)}})},t.prototype.navigateTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateTo({...e,success:function(t){e?.success?.call(wx,t)},complete:function(n){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,n)}})},t.prototype.navigateBack=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateBack({...e,complete:function(n){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,n)}})}})(R),R.prototype.updateStack=function(t){R.stack.lastPage=getCurrentPages()&&getCurrentPages().length&&getCurrentPages()[0].route,R.stack.currentPage=t.url};const Q=()=>new R,E=function(t,e){const o=e._state;let n={};for(const s in t)n[s]=t[s].bind(o),e[s]=n[s];e.actions=n},q=function(t,e){const o=e._state,n={};for(const s in t)n[s]=t[s].call(e,o);e.getters=n,e.gettersMethod=t},W=function(t,e){t||s("state is need in Stroe options"),"function"!=typeof t&&s("state not is a function"),e._da=t(),e._state=t(),e.stateMoudle=t};function P(t,e){this.id=t;const{getters:o,actions:n,state:s}=e;W(s,this),q(o,this),E(n,this),S(this._state,"$store$$"+this.id,this)}function S(t,e,o){for(const n in t)t[n]&&"Object"==t[n].constructor.name?S(t[n],e+"$$"+n,o):"Array"==t[n].constructor.name?K(t[n],o,e,n,val):Object.defineProperty(t,n,{set(t){j(o,e,n,t)},get:()=>o[e+"$$"+n]})}function j(t,e,o,n){t[e+"$$"+o]=n,q(t.gettersMethod,t),r.watch(e+"$$"+o,n,t.id);let s=(e+"$$"+o).split("$$");if(3==s.length)return void(t._da[s[2]]!==n&&(t._da[s[2]]=n));let a={};for(let e=2;e<s.length;e++)e<s.length-1?a=t._da[s[e]]:a[o]!==n&&(a[o]=n)}function _(t,e,o){for(const n in t)t[n]&&"Object"==t[n].constructor.name?_(t[n],e+"$$"+n,o):o.setData({[e+"$$"+n]:t[n]})}P.prototype.init=function(t){return _(this._da,"$store$$"+this.id,t),r.has(this.id,t)};const K=function(t,e,o,n,s){t.push=function(...r){Array.prototype.push.call(t,...r),j(e,o,n,s)},t.pop=function(...r){Array.prototype.pop.call(t,...r),j(e,o,n,s)},t.shift=function(...r){Array.prototype.shift.call(t,...r),j(e,o,n,s)},t.unshift=function(...r){Array.prototype.unshift.call(t,...r),j(e,o,n,s)},t.concat=function(...r){Array.prototype.concat.call(t,...r),j(e,o,n,s)}};function C(t,e){return r.addDep(t),new P(t,e)}export{b as WxComponet,v as WxRequest,Q as WxRouter,C as createStore,d as wxPage};
