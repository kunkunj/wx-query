!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["wx-query"]={})}(this,(function(t){"use strict";const e=t=>{Array.isArray(t)&&t.map((t=>{o(t)})),"function"==typeof t&&o(t)};function o(t){t.prototype.create=function(){return new t},t.create=function(){return new t},t.pages=[],t.getPages=function(){return this.pages}}const s=t=>"object"!=typeof t||!Object.keys(t).length,n=function(t){console.warn(t)},r=function(t){console.error(t)};function i(){}function a(t,e){if(t.Store&&t.Store.length){if("Array"!==t.Store.constructor.name)return void error("Store must a array");e.updateStoreState=function(t,o){e.setData({[t]:o})};for(let o=0;o<t.Store.length;o++)t.Store[o].init(e),i.pushDep(t.Store[o].id,e)}}i.data={},i.addDep=function(t){i.data[t]=[]},i.pushDep=function(t,e){if(!i.data[t])return void r("Store"+t+" is not create");const o=i.data[t].findIndex((t=>t.is==e.is));return o>-1?i.data[t].splice(o,1,e):i.data[t].push(e),t+(i.data[t].length-1)},i.watch=function(t,e,o){i.data[o].map((o=>{o.updateStoreState(t,e)}))},i.has=function(t,e){return!!i.data[t].find((t=>t.is==e.is))};const u=function(t,e,o){t.push=function(...s){Array.prototype.push.call(t,...s),e.setData({[o]:t})},t.pop=function(...s){Array.prototype.pop.call(t,...s),e.setData({[o]:t})},t.shift=function(...s){Array.prototype.shift.call(t,...s),e.setData({[o]:t})},t.unshift=function(...s){Array.prototype.unshift.call(t,...s),e.setData({[o]:t})},t.concat=function(...s){Array.prototype.concat.call(t,...s),e.setData({[o]:t})}};function c(t,e,o,s){for(const n in t)if("Object"==t[n].constructor.name)o.createDataKey(t[n],e+"$$"+n,o,s+"."+n);else{"Array"==t[n].constructor.name&&u(t[n],o,e+"$$"+n),o.setData({[e+"$$"+n]:t[n]}),Object.defineProperty(o.data,e+"$$"+n,{set(t){let s=(e+"$$"+n).split("$$");if(2==s.length)return void(o.observeData[s[1]]!==t&&(o.observeData[s[1]]=t));let r={};for(let e=1;e<s.length;e++)e<s.length-1?r=o.observeData[s[e]]:r[n]!==t&&(r[n]=t)},get:()=>t[n]});let r=s.split("."),i=o;r.map((t=>{i=i[t]})),t["_"+n]=t[n],Object.defineProperty(i,n,{set(s){t["_"+n]=s,o.setData({[e+"$$"+n]:s})},get:()=>t["_"+n]})}}function h(t){t.prototype.init=l,t.init=l}function l(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");s(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins),t.createDataKey=c;let e=t.onReady?t.onReady:null;t.onReady=function(){a(t,this),e&&e.call(this),this.observeData&&this.createDataKey(t.observeData,"observeData",this,"observeData")},Page(t)}const p=t=>{Array.isArray(t)&&t.map((t=>{f(t)})),"function"==typeof t&&f(t)};function f(t){t.prototype.plugins={},t.plugins={}}const d=t=>{Array.isArray(t)&&t.map((t=>{y(t)})),"function"==typeof t&&y(t)};function y(t){t.prototype.use=function(e){console.warn(e);try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){r("plugin need a install function")}return t},t.use=function(e){try{Array.isArray(e)?e.map((e=>{e.install&&e.install(t)})):e.install&&e.install(t)}catch(t){r("plugin need a install function")}return t}}function g(){}var x;g.pages=[],d(g),e(g),x=g,Array.isArray(x)&&x.map((t=>{h(t)})),"function"==typeof x&&h(x),p(g);function b(t){t.prototype.init=m,t.init=m}function m(t){if(t.createDataKey)throw new Error("请不要取名createDataKey");s(this.plugins)||(t.$keyName?t[t.$keyName]=this.plugins:t.$=this.plugins);let e=t?.lifetimes?.ready?t.lifetimes.ready:null;e=e||(t?.ready?t?.ready:null),t?.ready?t.ready=function(){a(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}:(t.lifetimes=t.lifetimes||{},t.lifetimes.ready=function(){a(t,this),this.createDataKey=c,t.observeData&&(this.observeData=t.observeData,this.createDataKey(t.observeData,"observeData",this,"observeData")),e&&e.call(this)}),Component(t)}function k(){}function $(){this.handlers=[]}function D(t){this.baseURL=t?.baseURL||"",this.timeout=t?.timeout||1e4,this.headers=t?.headers||{},this.interceptors={request:new $,response:new $}}function w(t){let e=t||{},o=this.interceptors.request.handlers.length,s=0;for(;s<o;){try{e=this.interceptors.request.handlers[s].success(t)}catch(t){this.interceptors.request.handlers[s].fail(t);break}s++}let n=this;return new Promise(((t,o)=>{wx.request({...e,url:this.baseURL?this.baseURL+e.url:e.url,timeout:e.timeout?e.timeout:this.timeout,headers:e.headers?e.headers:this.headers,success(e){let o=e,s=n.interceptors.response.handlers.length,r=0;for(;r<s;)o=/2\d+/.test(e.statusCode)?n.interceptors.response.handlers[r].success(e):n.interceptors.response.handlers[r].fail(e),r++;t(o)},fail(t){o(t)}})}))}k.pages=[],d(k),e(k),(t=>{Array.isArray(t)&&t.map((t=>{b(t)})),"function"==typeof t&&b(t)})(k),p(k),$.prototype.use=function(t,e){return this.handlers.push({success:t,fail:e}),this.handlers.length-1},$.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},$.prototype.clear=function(){this.handlers&&(this.handlers=[])},D.prototype.request=w,D.prototype.install=function(t){t.plugins.$request=this},D.prototype.post=function(t,e={}){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"post"})},D.prototype.get=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"get"})},D.prototype.delete=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"delete"})},D.prototype.head=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"head"})},D.prototype.trace=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"trace"})},D.prototype.put=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"put"})},D.prototype.options=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"options"})},D.prototype.connect=function(t,e){return"object"!=typeof e&&(e={}),this.request({url:t,...e,method:"connect"})};function v(t){t.create=function(t){return new D(t)}}function R(t){let e={...R.defaultConfig,interceptors:R.interceptors};return w.call(e,t)}R.interceptors={request:new $,response:new $},R.defaultConfig={},R.install=function(t){t.plugins.$request=R},(t=>{Array.isArray(t)&&t.map((t=>{v(t)})),"function"==typeof t&&v(t)})(R);class Q{quees=[];isExcute(){return this.quees.find((t=>!t.nextPage))}reset(){this.quees.map((t=>{t.reset()}))}execute(){this.quees.map((t=>{t.execute()}))}}function q(){this.isWatchRouter=!1}q.stack={currentPage:null,lastPage:null,routes:[]},function(t){t.hooksQuee=new Q}(q),(t=>{t.prototype.beforeEach=function(e){"function"!=typeof e&&r("beforeEach arg not a function"),this.isWatchRouter=!0,t.hooksQuee.quees.push(function(t,e){return{nextPage:!1,reset:function(){this.nextPage=!1},fn:t,execute:function(){this.fn(e.stack.lastPage,e.stack.currentPage,this.next.bind(this))},next:function(){this.nextPage=!0}}}(e,t))}})(q),(t=>{t.prototype.testpush=function(e){t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||this.isWatchRouter&&t.hooksQuee.reset()},t.prototype.switchTab=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.switchTab({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.reLaunch=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.reLaunch({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.redirectTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.redirectTo({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.navigateTo=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateTo({...e,success:function(t){e?.success?.call(wx,t)},complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})},t.prototype.navigateBack=function(e){let o=this;this.updateStack(e),t.hooksQuee.execute(),t.hooksQuee.isExcute()&&this.isWatchRouter?n("beforeEach hook need to execute next"):t.hooksQuee.isExcute()&&this.isWatchRouter||wx.navigateBack({...e,complete:function(s){o.isWatchRouter&&t.hooksQuee.reset(),e?.complete?.call(wx,s)}})}})(q),q.prototype.updateStack=function(t){q.stack.lastPage=getCurrentPages()&&getCurrentPages().length&&getCurrentPages()[0].route,q.stack.currentPage=t.url};const A=function(t,e){const o=e._state;let s={};for(const n in t)s[n]=t[n].bind(o),e[n]=s[n];e.actions=s},E=function(t,e){const o=e._state,s={};for(const n in t)s[n]=t[n].call(e,o);e.getters=s,e.gettersMethod=t},W=function(t,e){t||r("state is need in Stroe options"),"function"!=typeof t&&r("state not is a function"),e._da=t(),e._state=t(),e.stateMoudle=t};function P(t,e){this.id=t;const{getters:o,actions:s,state:n}=e;W(n,this),E(o,this),A(s,this),S(this._state,"$store$$"+this.id,this)}function S(t,e,o,s){for(const s in t)t[s]&&"Object"==t[s].constructor.name?S(t[s],e+"$$"+s,o):Object.defineProperty(t,s,{set(t){j(o,e,s,t)},get:()=>o[e+"$$"+s]})}function j(t,e,o,s){t[e+"$$"+o]=s,E(t.gettersMethod,t),i.watch(e+"$$"+o,s,t.id);let n=(e+"$$"+o).split("$$");if(3==n.length)return void(t._da[n[2]]!==s&&(t._da[n[2]]=s));let r={};for(let e=2;e<n.length;e++)e<n.length-1?r=t._da[n[e]]:r[o]!==s&&(r[o]=s)}function _(t,e,o,s){for(const s in t)t[s]&&"Object"==t[s].constructor.name?_(t[s],e+"$$"+s,o):o.setData({[e+"$$"+s]:t[s]})}P.prototype.init=function(t){return _(this._da,"$store$$"+this.id,t),i.has(this.id,t,this)},t.WxComponet=k,t.WxRequest=R,t.WxRouter=()=>new q,t.createStore=function(t,e){return i.addDep(t),new P(t,e)},t.wxPage=g,Object.defineProperty(t,"__esModule",{value:!0})}));
